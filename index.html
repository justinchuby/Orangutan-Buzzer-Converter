<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Orangutan Buzzer Converter</title>
    <script src="https://fb.me/react-0.14.7.min.js"></script>
    <script src="https://fb.me/react-dom-0.14.7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">  </head>
  <body>
    <div id="convertBox" align="center"></div>

    <script type="text/babel">
      var Converter = React.createClass({
        getInitialState: function () {
          return {"melody": 'Hello!', "time": "World!"};
        },
        convert: function (txt) {
            var notes = txt.split(",");
            for (var i = 0; i < notes.length; i++) {
                notes[i] = notes[i].trim();
            };
            return this.convertFromList(notes);
        },
        
        convertFromList: function (notes) {
            var melody = [];
            var time = [];
            var NOTE_LEN = 250;
            var SILENT_LEN = 30;
            var NOTE_MAP = {
                0: "SILENT_NOTE",
                1: "C(5)",
                2: "D(5)",
                3: "E(5)",
                4: "F(5)",
                5: "G(5)",
                6: "A(5)",
                7: "B(5)",
                14:"C(4)",
                24:"D(4)",
                34:"E(4)",
                44:"F(4)",
                54:"G(4)",
                64:"A(4)",
                74:"B(4)",
                16:"C(6)",
                26:"D(6)",
                36:"E(6)",
                46:"F(6)",
                56:"G(6)",
                66:"A(6)",
                76:"B(6)",
            };
            for (var j = 0; j < notes.length; j++) {
                var note = notes[j];
                // console.log(note);
                if (note in NOTE_MAP) {
                    if (j === 0 || note !== notes[j-1]) {
                        time = time.concat([NOTE_LEN]);
                    } else {
                        melody = melody.concat([NOTE_MAP[0]]);
                        time = time.concat([SILENT_LEN]);
                        time = time.concat([NOTE_LEN - SILENT_LEN]);
                    };
                    melody = melody.concat([NOTE_MAP[note]]);
                };
            };
            return({"melody": melody.join(", "), "time": time.join(", ")});
        },
        
        handleChange: function () {
          this.setState({value: event.target.value});
          this.setState(function(state) {
            return this.convert(state.value);
          });
        },
        
        textAreaStyle: {
          resize: "vertical"
        },
        
        render: function() {
          return (
            <div className="container">
              <h1> Orangutan Buzzer Converter </h1>
              <div className="row">
                <div className="col-md-10 col-md-offset-1">
                  <textarea className="form-control" style={this.textAreaStyle} rows="10" placeholder="Enter notes here" value={this.state.value} onChange={this.handleChange} />
                </div>
              </div>
              <div className="row">
                <div className="col-md-10 col-md-offset-1">
                  <pre className="text-left">
                  //Melody:<br/>{this.state.melody} <br/>
                  //Time:<br/>{this.state.time}
                  </pre>
                </div>
              </div>
             </div>
        );
        }
      });

      ReactDOM.render(
        <Converter />,
        document.getElementById('convertBox')
      );
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>  </body>
</html>
